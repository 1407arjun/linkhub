name: Create a Pull Request

on:
  push:
    branches: [ backend, frontend ]
    
jobs:
  backend:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16.x]
    if: ${{ github.ref == 'refs/heads/backend' }}    
    steps:
      - uses: actions/checkout@v2
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v2
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
      
      - name: Update package.json
        run: |-
          npm ci
          npm i -g json
          json -I -f package.json -e "this.scripts.build=\"cd .next && npm install && npm run build\""
          
          git config --global user.email "arjun140702@gmail.com"
          git config --global user.name "Arjun"
          git diff
          git add .
          git commit -m "refactor: Update build command"
          git push -f origin backend
          
      - name: Make a pull request
        run: |-
          uses: peter-evans/create-pull-request@v3
          with:
            title: Backend Deployment
            branch-suffix: backend
            
  frontend:
    runs-on: ubuntu-latest
    
    if: ${{ github.ref == 'refs/heads/frontend' }}    
    steps:
      - uses: actions/checkout@v2
     
      - name: Make a pull request
        run: |-
          uses: peter-evans/create-pull-request@v3
          with:
            title: Frontend Deployment
            branch-suffix: frontend
